<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シフトエディタ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Zen+Kurenaido&display=swap"
        rel="stylesheet">
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="../config.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/manager/shiftEdit.css">
</head>

<body>
    <div class="common-header">
        <div class="common-header-inner">
            <div class="header-left">
                <a href="./index.html" class="header-back-btn"><i class="fas fa-chevron-left"></i></a>
                <h1 class="header-title" id="pageTitle">シフトエディタ</h1>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <span class="user-name" id="userName">ユーザー</span>
                    <span class="role-badge role-badge-default" id="userRole">未設定</span>
                </div>
            </div>
        </div>
    </div>
    <div id="json-modal" class="custom-modal">
        <div class="modal-header">
            <h3 class="modal-title">JSONデータ編集</h3>
            <div class="modal-header-actions">
                <button class="modal-btn btn-cancel" id="btn-json-cancel">取消</button>
                <button class="modal-btn btn-save" id="btn-json-save">保存</button>
            </div>
        </div>
        <div class="modal-body">
            <div style="font-size:13px; color:#666; margin-bottom:8px;">※編集後、保存を押すと画面が更新されます。</div>
            <textarea id="json-input" rows="15"></textarea>
            <button class="modal-action-btn-bottom" id="btn-download-json-modal">出力</button>
        </div>
    </div>

    <div id="preview-modal" class="custom-modal">
        <div class="modal-header">
            <h3 class="modal-title">プレビュー</h3>
            <div class="modal-header-actions">
                <button class="modal-btn btn-cancel" id="btn-preview-close">閉じる</button>
            </div>
        </div>
        <div class="modal-body">
            <div id="preview-image-container"></div>
            <button class="modal-action-btn-bottom" id="btn-preview-save">保存</button>
        </div>
    </div>

    <div id="shift-modal" class="custom-modal">
        <div class="modal-header">
            <h3 class="modal-title">シフト編集</h3>
            <div class="modal-header-actions">
                <button class="modal-btn btn-delete" id="btn-modal-delete" style="display:none;">削除</button>
                <button class="modal-btn btn-cancel" id="btn-modal-cancel">取消</button>
                <button class="modal-btn btn-save" id="btn-modal-save">確定</button>
            </div>
        </div>
        <div class="modal-body">
            <input type="hidden" id="modal-original-key">
            <input type="hidden" id="modal-original-day">
            <input type="hidden" id="modal-original-staff-id">
            <input type="hidden" id="modal-original-start">
            <input type="hidden" id="modal-original-end">
            <div class="modal-row"><label>日付</label>
                <select id="modal-day-select"></select>
            </div>
            <div class="modal-row"><label>スタッフ</label>
                <div style="flex:1; display:flex; gap:5px;">
                    <input type="text" id="modal-staff-name" readonly
                        style="flex:1; cursor:pointer; background:#f9f9f9;" placeholder="選択してください">
                    <input type="hidden" id="modal-staff-id">
                    <button type="button" id="btn-open-staff-select-modal" class="modal-btn btn-pale-blue">選択</button>
                </div>
            </div>
            <div class="modal-row"><label>開始</label>
                <div class="time-select-group">
                    <select id="modal-start-h" style="width: auto;"></select> :
                    <select id="modal-start-m" style="width: auto;">
                        <option value="0">00</option>
                        <option value="0.25">15</option>
                        <option value="0.5">30</option>
                        <option value="0.75">45</option>
                    </select>
                </div>
            </div>
            <div class="modal-row"><label>終了</label>
                <div class="time-select-group">
                    <select id="modal-end-h" style="width: auto;"></select> :
                    <select id="modal-end-m" style="width: auto;">
                        <option value="0">00</option>
                        <option value="0.25">15</option>
                        <option value="0.5">30</option>
                        <option value="0.75">45</option>
                    </select>
                </div>
            </div>
            <div class="modal-row"><label>補足</label><input type="text" id="modal-sub-text" placeholder="メモ"></div>
        </div>
    </div>

    <div id="note-modal" class="custom-modal">
        <div class="modal-header">
            <h3 class="modal-title">メモ編集</h3>
            <div class="modal-header-actions">
                <button class="modal-btn btn-delete" id="btn-note-delete">削除</button>
                <button class="modal-btn btn-cancel" id="btn-note-cancel">取消</button>
                <button class="modal-btn btn-save" id="btn-note-save">確定</button>
            </div>
        </div>
        <div class="modal-body">
            <input type="hidden" id="note-modal-day">
            <div class="modal-row">
                <textarea id="note-text" rows="4" style="resize:none;"></textarea>
            </div>
        </div>
    </div>

    <div id="highlight-modal" class="custom-modal">
        <div class="modal-header">
            <h3 class="modal-title">強調表示するスタッフを選択</h3>
            <div class="modal-header-actions">
                <button class="modal-btn btn-cancel" id="btn-highlight-close">閉じる</button>
            </div>
        </div>
        <div class="modal-body">
            <div style="margin-bottom: 15px;">
                <button class="modal-btn btn-pale-blue" id="btn-highlight-clear"
                    style="width:100%; justify-content:center;">
                    強調解除（なし）
                </button>
            </div>
            <div id="staff-select-grid" class="staff-grid"></div>
        </div>
    </div>

    <div id="date-change-modal" class="custom-modal">
        <div class="modal-header">
            <h3 class="modal-title">日付を選択</h3>
            <div class="modal-header-actions">
                <button class="modal-btn btn-cancel" id="btn-date-change-close">閉じる</button>
            </div>
        </div>
        <div class="modal-body">
            <div id="date-select-grid" style="display: grid; grid-template-columns: 1fr; gap: 8px;"></div>
        </div>
    </div>

    <div id="store-change-modal" class="custom-modal">
        <div class="modal-header">
            <h3 class="modal-title">店舗を選択</h3>
            <div class="modal-header-actions">
                <button class="modal-btn btn-cancel" id="btn-store-change-close">閉じる</button>
            </div>
        </div>
        <div class="modal-body">
            <div id="store-select-grid" style="display: grid; grid-template-columns: 1fr; gap: 8px;"></div>
        </div>
    </div>

    <div id="staff-selector-modal" class="custom-modal" style="width: 600px; max-width:90%;">
        <div class="modal-header">
            <h3 class="modal-title">スタッフ選択（店舗別）</h3>
            <div class="modal-header-actions">
                <button class="modal-btn btn-cancel" id="btn-staff-selector-close">閉じる</button>
            </div>
        </div>
        <div class="modal-body" style="display:flex; gap:10px; height:400px; padding:0 24px 24px 24px;">
            <div id="selector-store-list"
                style="width:160px; border-right:1px solid #ddd; background:#f4f4f4; overflow-y:auto; border-radius: 8px 0 0 8px;">
            </div>
            <div id="selector-staff-list"
                style="flex:1; overflow-y:auto; padding:10px; display:grid; grid-template-columns:repeat(auto-fill, minmax(140px, 1fr)); align-content:start; gap:8px;">
            </div>
        </div>
    </div>

    <div id="modal-overlay" class="modal-overlay"></div>

    <div id="floating-control-area">
        <div id="control-panel">
            <div class="control-group">
                <div class="control-label">表示範囲</div>
                <button class="toggle-btn selected" data-mode="original">オリジナル</button>
                <button class="toggle-btn" data-mode="night">２４時間</button>
                <button class="toggle-btn" data-mode="wide">ワイド</button>
            </div>

            <div class="control-group">
                <div class="control-label">赤線</div>
                <button class="toggle-btn" id="btn-red-on">ON</button>
                <button class="toggle-btn selected" id="btn-red-off">OFF</button>
            </div>
            <div class="control-group">
                <div class="control-label">翌日表示</div>
                <button class="toggle-btn" id="btn-next-on">ON</button>
                <button class="toggle-btn selected" id="btn-next-off">OFF</button>
            </div>
            <div class="control-group">
                <div class="control-label">前日表示</div>
                <button class="toggle-btn" id="btn-prev-on">ON</button>
                <button class="toggle-btn selected" id="btn-prev-off">OFF</button>
            </div>
            <div class="control-group">
                <div class="control-label">勤務時間</div>
                <button class="toggle-btn" id="btn-duration-on">ON</button>
                <button class="toggle-btn selected" id="btn-duration-off">OFF</button>
            </div>
            <div class="control-group">
                <div class="control-label">強調表示</div>
                <button class="toggle-btn btn-pale-blue" id="btn-open-highlight"
                    style="width:140px; justify-content:space-between;">
                    <span id="highlight-label">なし</span> <span style="font-size:0.8em;">▼</span>
                </button>
            </div>
        </div>
    </div>

    <div id="date-control-area"
        style="width: 100%; max-width: var(--app-width); margin: 0 auto; padding: 10px 10px; box-sizing: border-box; display: flex; justify-content: space-between; align-items: center; gap: 10px;">
        <button class="btn-pale-blue" id="btn-change-store"
            style="flex: 1; justify-content:space-between; padding:10px 16px;">
            <span id="store-change-label">志免南里１丁目</span> <span style="font-size:0.8em;">▼</span>
        </button>
        <button class="btn-pale-blue" id="btn-change-date"
            style="flex: 1; justify-content:space-between; padding:10px 16px;">
            <span id="date-change-label">2026/01/26週（進行中）</span> <span style="font-size:0.8em;">▼</span>
        </button>
    </div>

    <div class="main-scroll-container">
        <div id="app-wrapper" class="border-pending">
            <div id="status-bar-field" class="status-pending">
                <div id="status-label"><span id="current-status">未確定のシフト：要件を達成しているかを確認し修正が必要な場合は修正してください</span></div>
                <div style="position: relative;">
                    <div id="status-menu-btn">
                        <div class="bar-white"></div>
                        <div class="bar-white"></div>
                        <div class="bar-white"></div>
                    </div>
                    <div id="status-dropdown">
                        <div class="status-menu-item" data-status="未確定">未確定</div>
                        <div class="status-menu-item" data-status="確定">確定</div>
                        <div class="status-menu-item" data-status="最終">最終</div>
                    </div>
                </div>
            </div>

            <div id="main-content-wrapper">
                <div id="title-field">
                    <div class="title-part" id="store-title-area"></div>
                    <div class="title-part" id="title-center"></div>
                    <div class="title-part"></div>
                </div>

                <div id="table-frame" class="hide-duration">
                    <div class="sticky-header">
                        <div class="col-date">
                            <div class="date-header-cell">
                                <div class="date-content-area" id="header-date-content-area">
                                    <div class="header-text-container">
                                        <span class="lbl-time">時間</span>
                                        <span class="lbl-day">曜日</span>
                                    </div>
                                </div>
                                <div class="date-spacer-area"
                                    style="border:none; animation:none; cursor:default; background:none;"></div>
                            </div>
                        </div>
                        <div class="col-timeline" id="header-timeline-container">
                            <div class="timeline-header" id="timeline-axis"></div>
                        </div>
                        <div class="col-summary">
                            <div class="summary-header">
                                <div class="sh-left"></div>
                                <div class="sh-right"><span>総</span><span>時</span><span>間</span></div>
                            </div>
                        </div>
                    </div>
                    <div id="shift-rows-container"></div>
                </div>
                <div id="shift-footer">総時間　その日時点での実労働時間</div>
            </div>
        </div>
    </div>
    <div id="bottom-control-panel">
        <div class="btn-group" style="display:flex;">
            <button class="btn-yellow" id="btn-add-shift">シフト追加</button>
            <button class="btn-pale-blue" id="btn-edit-json" style="margin-left:10px;">JSON編集</button>
            <button class="btn-red" id="btn-reset" style="margin-left:10px;">リセット</button>
        </div>
        <div class="btn-group" style="display:flex;">
            <button class="btn-pale-blue" id="btn-preview" style="margin-left:10px;">プレビュー</button>
            <button class="btn-blue" id="btn-confirm-shift" style="margin-left:10px;">シフト確定</button>
        </div>
    </div>

    <div id="side-menu-overlay" style="display:none;"></div>
    <div id="side-menu-drawer">
        <div class="drawer-header">
            <span>メニュー</span>
            <button id="drawer-close-btn">×</button>
        </div>
        <div class="drawer-content">
            <div class="drawer-item" id="drawer-store">店舗選択</div>
            <div class="drawer-item" id="drawer-json">JSON編集</div>
            <div class="drawer-item" id="drawer-dark-mode">ダークモード切替</div>
            <div class="drawer-item" id="drawer-reset" style="color:#e53935;">リセット</div>
        </div>
    </div>

    <div id="sticky-time-header" class="sticky-time-header">
        <div id="sticky-timeline-content" style="position: relative; height: 100%;"></div>
    </div>

    <script src="../assets/js/manager/shiftEdit.js"></script>
    <div class="common-footer">
        <div class="common-footer-inner">
            <p>&copy; 2026 Shift Management System. All rights reserved.</p>
        </div>
    </div>
</body>

</html>
